// --- Traducciones (Limpiadas y Copyright Actualizado) ---
    const translations = {
      es: {
        page_title: "Nombre del Juego - Aventura de Terror Psicológico", // Reemplaza "Nombre del Juego"
        nav_game: "Juego",
        nav_story: "Historia Interactiva",
        nav_demo: "Demo",
        nav_about: "Sobre Mí",
        nav_faq: "FAQ",
        lang_select_label: "Idioma:",
        main_game_title: "Nombre del Juego", // Reemplaza "Nombre del Juego"
        game_logo_alt: "Logo del Juego", // Alt text para el logo
        buy_button: "Comprar Ahora",
        concept_art_title: "Concept Art",
        story_title: "Historia Interactiva",
        demo_title: "Demo",
        demo_intro: "¿Te atreves a probar un fragmento de la locura?",
        demo_download_prompt: "Descarga la demo aquí:",
        demo_link_steam: "Descargar Demo para PC (Steam)",
        demo_link_itch: "Descargar Demo para PC (Itch.io)",
        demo_link_other: "Plataforma Adicional", // Texto genérico
        demo_outro: "Sumérgete en el retorcido mundo y experimenta el suspense...",
        about_title: "Sobre el Desarrollador",
        about_p1: "Soy ZIMMZIMM Game Studio, un desarrollador independiente apasionado por crear experiencias inmersivas y perturbadoras.", // Ejemplo con nombre
        about_p2: "Mi objetivo con Nombre del Juego es explorar los rincones más oscuros de la psique humana, envuelto en una estética surrealista inspirada en los cuentos clásicos, pero con un giro macabro.", // Reemplaza "Nombre del Juego"
        about_p3: "Este proyecto es un viaje personal hacia el terror psicológico, combinando narrativa, atmósfera y misterio.",
        about_p4: "Puedes seguir el desarrollo y mis pensamientos en mis redes sociales.",
        faq_title: "Preguntas Frecuentes (FAQ)",
        faq_q_platforms: "P: ¿En qué plataformas estará disponible el juego?",
        faq_a_platforms: "R: El lanzamiento inicial está planeado para PC (Steam). Estamos explorando la posibilidad de llevarlo a consolas (ej. PS5, Xbox) en el futuro.",
        faq_q_release: "P: ¿Cuál es la fecha de lanzamiento estimada?",
        faq_a_release: "R: Actualmente estamos trabajando arduamente. La fecha estimada es \"Próximamente\". ¡Sigue nuestras redes para actualizaciones!",
        faq_q_langs: "P: ¿Qué idiomas soportará el juego?", // Pregunta más genérica
        faq_a_langs: "R: El juego se lanzará en inglés y español. Estamos considerando añadir más idiomas post-lanzamiento basados en el interés de la comunidad.",
        faq_q_inspired: "P: ¿Qué inspiró la estética del juego?",
        faq_a_inspired: "R: La principal inspiración es una fusión entre la atmósfera onírica y desorientadora de \"Alicia en el País de las Maravillas\" y elementos clásicos del cine de suspense y terror psicológico, buscando crear un mundo familiar pero profundamente inquietante.",
        faq_q_jumpscares: "P: ¿Es un juego de terror con 'jumpscares'?",
        faq_a_jumpscares: "R: El enfoque principal está en el terror psicológico, la atmósfera y el suspense narrativo. Puede haber momentos sobresaltantes, pero no dependen principalmente de 'jumpscares' para generar miedo.",
        copyright: "© 2025 ZIMMZIMM Game Studio. Todos los derechos reservados.", // Actualizado
        chatbot_button_label: "Abrir Chatbot"
      },
      en: {
        page_title: "Game Name - Psychological Horror Adventure", // Replace "Game Name"
        nav_game: "Game",
        nav_story: "Interactive Story",
        nav_demo: "Demo",
        nav_about: "About Me",
        nav_faq: "FAQ",
        lang_select_label: "Language:",
        main_game_title: "Game Name", // Replace "Game Name"
        game_logo_alt: "Game Logo", // Alt text for logo
        buy_button: "Buy Now",
        concept_art_title: "Concept Art",
        story_title: "Interactive Story",
        demo_title: "Demo",
        demo_intro: "Dare to try a fragment of madness?",
        demo_download_prompt: "Download the demo here:",
        demo_link_steam: "Download Demo for PC (Steam)",
        demo_link_itch: "Download Demo for PC (Itch.io)",
        demo_link_other: "Additional Platform", // Generic text
        demo_outro: "Immerse yourself in the twisted world and experience the suspense...",
        about_title: "About the Developer",
        about_p1: "I am ZIMMZIMM Game Studio, an independent developer passionate about creating immersive and unsettling experiences.", // Example with name
        about_p2: "My goal with Game Name is to explore the darkest corners of the human psyche, wrapped in a surreal aesthetic inspired by classic tales, but with a macabre twist.", // Replace "Game Name"
        about_p3: "This project is a personal journey into psychological horror, combining narrative, atmosphere, and mystery.",
        about_p4: "You can follow the development and my thoughts on my social media.",
        faq_title: "Frequently Asked Questions (FAQ)",
        faq_q_platforms: "Q: What platforms will the game be available on?",
        faq_a_platforms: "A: The initial release is planned for PC (Steam). We are exploring the possibility of bringing it to consoles (e.g., PS5, Xbox) in the future.",
        faq_q_release: "Q: What is the estimated release date?",
        faq_a_release: "A: We are currently working hard. The estimated date is \"Coming Soon\". Follow our networks for updates!",
        faq_q_langs: "Q: What languages will the game support?", // More generic question
        faq_a_langs: "A: The game will launch in English and Spanish. We are considering adding more languages post-launch based on community interest.",
        faq_q_inspired: "Q: What inspired the game's aesthetic?",
        faq_a_inspired: "A: The main inspiration is a fusion between the dreamlike and disorienting atmosphere of \"Alice in Wonderland\" and classic elements of suspense and psychological horror cinema, seeking to create a familiar yet deeply unsettling world.",
        faq_q_jumpscares: "Q: Is it a horror game with jumpscares?",
        faq_a_jumpscares: "A: The main focus is on psychological horror, atmosphere, and narrative suspense. There may be startling moments, but it doesn't rely primarily on jumpscares to generate fear.",
        copyright: "© 2025 ZIMMZIMM Game Studio. All rights reserved.", // Updated
        chatbot_button_label: "Open Chatbot"
      },
      ja: { // PLACEHOLDERS - Cleaned up markers
        page_title: "ゲーム名 - 心理ホラーアドベンチャー", // Reemplaza "ゲーム名"
        nav_game: "ゲーム",
        nav_story: "インタラクティブストーリー",
        nav_demo: "デモ",
        nav_about: "開発者について",
        nav_faq: "よくある質問",
        lang_select_label: "言語:",
        main_game_title: "ゲーム名", // Reemplaza "ゲーム名"
        game_logo_alt: "ゲームロゴ",
        buy_button: "今すぐ購入",
        concept_art_title: "コンセプトアート",
        story_title: "インタラクティブストーリー",
        demo_title: "デモ",
        demo_intro: "狂気のかけらを試してみませんか？",
        demo_download_prompt: "デモはこちらからダウンロード:",
        demo_link_steam: "PC用デモをダウンロード (Steam)",
        demo_link_itch: "PC用デモをダウンロード (Itch.io)",
        demo_link_other: "追加プラットフォーム", // Generic text
        demo_outro: "歪んだ世界に没入し、サスペンスを体験してください...",
        about_title: "開発者について",
        about_p1: "私はZIMMZIMM Game Studio、没入型で不安な体験を作ることに情熱を燃やす独立系開発者です。", // Example
        about_p2: "ゲーム名での私の目標は、古典的な物語に触発されたシュールな美学に包まれ、しかし不気味なひねりを加えた、人間の精神の最も暗い隅を探求することです。", // Reemplaza "ゲーム名"
        about_p3: "このプロジェクトは、物語、雰囲気、謎を組み合わせた、心理的ホラーへの個人的な旅です。",
        about_p4: "開発状況や私の考えは、私のソーシャルメディアでフォローできます。",
        faq_title: "よくある質問 (FAQ)",
        faq_q_platforms: "Q: ゲームはどのプラットフォームで利用できますか？",
        faq_a_platforms: "A: 初期リリースはPC（Steam）で計画されています。将来的にはコンソール（例：PS5、Xbox）への移植の可能性を探っています。",
        faq_q_release: "Q: 推定リリース日はいつですか？",
        faq_a_release: "A: 現在、鋭意開発中です。推定日は「近日公開」です。最新情報については、私たちのネットワークをフォローしてください！",
        faq_q_langs: "Q: ゲームはどの言語をサポートしますか？",
        faq_a_langs: "A: ゲームは英語とスペイン語でリリースされます。コミュニティの関心に基づいて、リリース後に追加の言語を追加することを検討しています。",
        faq_q_inspired: "Q: ゲームの美学は何に触発されましたか？",
        faq_a_inspired: "A: 主なインスピレーションは、「不思議の国のアリス」の夢のような方向感覚を失わせる雰囲気と、サスペンスと心理的ホラー映画の古典的な要素の融合であり、馴染み深いが深く不安な世界を作り出すことを目指しています。",
        faq_q_jumpscares: "Q: ジャンプスケアのあるホラーゲームですか？",
        faq_a_jumpscares: "A: 主な焦点は心理的ホラー、雰囲気、物語のサスペンスです。驚くような瞬間があるかもしれませんが、恐怖を生み出すために主にジャンプスケアに依存するわけではありません。",
        copyright: "© 2025 ZIMMZIMM Game Studio. All rights reserved.", // Updated (Using English as base)
        chatbot_button_label: "チャットボットを開く"
      },
      ru: { // PLACEHOLDERS - Cleaned up markers
        page_title: "Название игры - Психологическое хоррор-приключение", // Замените "Название игры"
        nav_game: "Игра",
        nav_story: "Интерактивная история",
        nav_demo: "Демо",
        nav_about: "Обо мне",
        nav_faq: "ЧАВО",
        lang_select_label: "Язык:",
        main_game_title: "Название игры", // Замените "Название игры"
        game_logo_alt: "Логотип игры",
        buy_button: "Купить сейчас",
        concept_art_title: "Концепт-арт",
        story_title: "Интерактивная история",
        demo_title: "Демо",
        demo_intro: "Осмелитесь попробовать фрагмент безумия?",
        demo_download_prompt: "Скачать демо здесь:",
        demo_link_steam: "Скачать демо для ПК (Steam)",
        demo_link_itch: "Скачать демо для ПК (Itch.io)",
        demo_link_other: "Дополнительная платформа", // Generic text
        demo_outro: "Погрузитесь в искаженный мир и испытайте напряжение...",
        about_title: "О разработчике",
        about_p1: "Я ZIMMZIMM Game Studio, независимый разработчик, увлеченный созданием захватывающих и тревожных впечатлений.", // Example
        about_p2: "Моя цель в Название игры - исследовать самые темные уголки человеческой психики, обернутые в сюрреалистическую эстетику, вдохновленную классическими сказками, но с жутким поворотом.", // Замените "Название игры"
        about_p3: "Этот проект - личное путешествие в психологический ужас, сочетающее повествование, атмосферу и тайну.",
        about_p4: "Вы можете следить за разработкой и моими мыслями в моих социальных сетях.",
        faq_title: "Часто задаваемые вопросы (ЧАВО)",
        faq_q_platforms: "В: На каких платформах будет доступна игра?",
        faq_a_platforms: "О: Первоначальный выпуск запланирован для ПК (Steam). Мы изучаем возможность переноса на консоли (например, PS5, Xbox) в будущем.",
        faq_q_release: "В: Какова предполагаемая дата выпуска?",
        faq_a_release: "О: В настоящее время мы усердно работаем. Предполагаемая дата - \"Скоро\". Следите за нашими сетями для обновлений!",
        faq_q_langs: "В: Какие языки будет поддерживать игра?",
        faq_a_langs: "О: Игра будет выпущена на английском и испанском языках. Мы рассматриваем возможность добавления дополнительных языков после запуска на основе интереса сообщества.",
        faq_q_inspired: "В: Что вдохновило эстетику игры?",
        faq_a_inspired: "О: Основное вдохновение - это слияние сказочной и дезориентирующей атмосферы \"Алисы в стране чудес\" и классических элементов саспенса и психологического хоррора, стремящееся создать знакомый, но глубоко тревожный мир.",
        faq_q_jumpscares: "В: Это хоррор-игра со скримерами?",
        faq_a_jumpscares: "О: Основное внимание уделяется психологическому ужасу, атмосфере и повествовательному напряжению. Могут быть пугающие моменты, но игра не полагается в первую очередь на скримеры для создания страха.",
        copyright: "© 2025 ZIMMZIMM Game Studio. Все права защищены.", // Updated (Using English as base)
        chatbot_button_label: "Открыть чат-бот"
      }
    };

    // --- Estructura de Datos de la Historia con Traducciones (Limpiada) ---
    const storyData = {
      start: {
        image: "story-image-forest.png",
        text: {
          es: "El aire es pesado, huele a tierra húmeda y a algo más... dulce y metálico.\nTe encuentras ante un sendero retorcido que se pierde en la espesura de un bosque imposible, donde los árboles susurran secretos olvidados.",
          en: "The air is heavy, smells of damp earth and something else... sweet and metallic.\nYou stand before a twisted path that disappears into the thicket of an impossible forest, where the trees whisper forgotten secrets.",
          ja: "空気は重く、湿った土と何か別のもの…甘くて金属的な匂いがする。\nありえない森の茂みに消えるねじれた道の前に立っている。そこでは木々が忘れられた秘密を囁いている。", // Marcador eliminado
          ru: "Воздух тяжелый, пахнет влажной землей и чем-то еще... сладким и металлическим.\nВы стоите перед извилистой тропой, исчезающей в чаще невозможного леса, где деревья шепчут забытые секреты." // Marcador eliminado
        },
        choices: [
          { text: { es: "Seguir el sendero", en: "Follow the path", ja: "小道を進む", ru: "Идти по тропе" }, target: "path" }, // Marcadores eliminados
          { text: { es: "Examinar los árboles cercanos", en: "Examine the nearby trees", ja: "近くの木を調べる", ru: "Осмотреть ближайшие деревья" }, target: "examine_trees" } // Marcadores eliminados
        ]
      },
       path: {
        image: "story-image-path.png",
        text: {
          es: "Avanzas con cautela. Las sombras danzan como espectros y cada crujido de hojas secas parece una advertencia.\nEl sendero se bifurca frente a una estatua grotesca de un conejo sonriente.",
          en: "You advance cautiously. Shadows dance like specters, and every rustle of dry leaves sounds like a warning.\nThe path forks in front of a grotesque statue of a smiling rabbit.",
          ja: "慎重に進む。影が幽霊のように踊り、乾いた葉のすべてのガサガサという音が警告のように聞こえる。\n道は微笑むウサギのグロテスクな像の前で分岐している。",
          ru: "Вы осторожно продвигаетесь вперед. Тени танцуют, как призраки, и каждый шорох сухих листьев звучит как предупреждение.\nТропа разветвляется перед гротескной статуей улыбающегося кролика."
        },
        choices: [
          { text: { es: "Ir por la izquierda, hacia la risa ahogada", en: "Go left, towards the muffled laughter", ja: "左へ、くぐもった笑い声の方へ", ru: "Идти налево, к приглушенному смеху" }, target: "left_path" },
          { text: { es: "Ir por la derecha, hacia el silencio expectante", en: "Go right, towards the expectant silence", ja: "右へ、期待に満ちた静寂の方へ", ru: "Идти направо, к ожидающей тишине" }, target: "right_path" },
          { text: { es: "Volver al inicio", en: "Return to the start", ja: "最初に戻る", ru: "Вернуться к началу" }, target: "start" }
        ]
      },
       examine_trees: {
        text: {
            es: "Te acercas a un tronco nudoso. La corteza parece retorcerse formando rostros quejumbrosos.\nSientes una presencia observándote desde las ramas más altas.",
            en: "You approach a gnarled trunk. The bark seems to twist into wailing faces.\nYou feel a presence watching you from the higher branches.",
            ja: "節くれだった幹に近づく。樹皮はうめき声を上げる顔を形作っているように見える。\n高い枝からあなたを見ている存在を感じる。",
            ru: "Вы подходите к корявому стволу. Кора, кажется, скручивается в плачущие лица.\nВы чувствуете присутствие, наблюдающее за вами с верхних ветвей."
        },
        choices: [
          { text: { es: "Ignorar la sensación y seguir el sendero", en: "Ignore the feeling and follow the path", ja: "感覚を無視して小道を進む", ru: "Игнорировать ощущение и идти по тропе" }, target: "path" },
          { text: { es: "Intentar escalar el árbol", en: "Try to climb the tree", ja: "木に登ろうとする", ru: "Попытаться залезть на дерево" }, target: "climb_tree" }
        ]
      },
       left_path: {
        image: "story-image-laugh.png",
        text: {
            es: "Un sonido que podría ser una risa o un sollozo te guía. Llegas a un claro donde tazas de té flotan en el aire.\nUna figura sombría te ofrece una taza.",
            en: "A sound that could be laughter or sobbing guides you. You reach a clearing where teacups float in the air.\nA shadowy figure offers you a cup.",
            ja: "笑い声かすすり泣きかもしれない音があなたを導く。ティーカップが空中に浮かぶ空き地にたどり着く。\n影のような人物があなたにカップを差し出す。",
            ru: "Звук, который может быть смехом или рыданием, ведет вас. Вы выходите на поляну, где в воздухе парят чайные чашки.\nТемная фигура предлагает вам чашку."
        },
        choices: [
          { text: { es: "Aceptar la taza", en: "Accept the cup", ja: "カップを受け入れる", ru: "Принять чашку" }, target: "accept_tea" },
          { text: { es: "Rechazar y huir", en: "Refuse and flee", ja: "断って逃げる", ru: "Отказаться и бежать" }, target: "flee_tea" }
        ]
      },
       right_path: {
        text: {
            es: "El silencio es denso, casi palpable. El aire se enfría.\nEncuentras un viejo reloj de bolsillo en el suelo, detenido a las 3:33.",
            en: "The silence is dense, almost palpable. The air grows cold.\nYou find an old pocket watch on the ground, stopped at 3:33.",
            ja: "静寂は濃く、ほとんど触れることができるほどだ。空気が冷たくなる。\n地面に古い懐中時計を見つける。3時33分で止まっている。",
            ru: "Тишина плотная, почти осязаемая. Воздух становится холодным.\nВы находите на земле старые карманные часы, остановившиеся на 3:33."
        },
        choices: [
          { text: { es: "Recoger el reloj", en: "Pick up the watch", ja: "時計を拾う", ru: "Подобрать часы" }, target: "take_watch" },
          { text: { es: "Dejarlo y seguir", en: "Leave it and continue", ja: "そのままにして進む", ru: "Оставить и идти дальше" }, target: "continue_right" }
        ]
      },
       climb_tree: {
        text: {
            es: "Las ramas son resbaladizas, cubiertas de un musgo extraño. Pierdes el agarre y caes.\nTodo se vuelve oscuro.",
            en: "The branches are slippery, covered in strange moss. You lose your grip and fall.\nEverything goes dark.",
            ja: "枝は滑りやすく、奇妙な苔で覆われている。握力を失い、落ちる。\nすべてが暗くなる。",
            ru: "Ветви скользкие, покрыты странным мхом. Вы теряете хватку и падаете.\nВсе темнеет."
        },
        choices: [
          { text: { es: "Despertar...", en: "Wake up...", ja: "目を覚ます...", ru: "Проснуться..." }, target: "start" }
        ]
      },
       accept_tea: {
        text: {
            es: "El líquido es espeso y sabe a recuerdos olvidados. Tu visión se nubla...",
            en: "The liquid is thick and tastes like forgotten memories. Your vision blurs...",
            ja: "液体は濃く、忘れられた記憶の味がする。視界がぼやける...",
            ru: "Жидкость густая и на вкус как забытые воспоминания. Ваше зрение затуманивается..."
        },
        choices: [
          { text: { es: "...", en: "...", ja: "...", ru: "..." }, target: "start" }
        ]
      },
       flee_tea: {
           image: "story-image-path.png",
           text: {
               es: "Corres sin mirar atrás, volviendo al cruce de la estatua del conejo.",
               en: "You run without looking back, returning to the rabbit statue junction.",
               ja: "後ろを振り返らずに走り、ウサギの像の分岐点に戻る。",
               ru: "Вы бежите без оглядки, возвращаясь к перекрестку со статуей кролика."
           },
           choices: [
             { text: { es: "Ir por la derecha esta vez", en: "Go right this time", ja: "今度は右へ", ru: "На этот раз пойти направо" }, target: "right_path" },
             { text: { es: "Volver al inicio del bosque", en: "Return to the forest entrance", ja: "森の入り口に戻る", ru: "Вернуться к началу леса" }, target: "start" }
           ]
       },
       take_watch: {
           text: {
               es: "Al tocar el frío metal, sientes un escalofrío recorrerte. Las manecillas giran violentamente y se detienen de nuevo.\nEl bosque parece haber cambiado a tu alrededor.",
               en: "Touching the cold metal, you feel a shiver run down your spine. The hands spin wildly and stop again.\nThe forest seems to have changed around you.",
               ja: "冷たい金属に触れると、背筋に悪寒が走る。針が激しく回転し、再び止まる。\nあなたの周りの森が変わったようだ。",
               ru: "Прикоснувшись к холодному металлу, вы чувствуете, как по спине пробегает дрожь. Стрелки бешено вращаются и снова останавливаются.\nЛес вокруг вас, кажется, изменился."
           },
           choices: [
               { text: { es: "Continuar por el camino silencioso", en: "Continue down the silent path", ja: "静かな道を進み続ける", ru: "Продолжить идти по тихой тропе" }, target: "continue_right_changed" }
           ]
       },
       continue_right: {
           text: {
               es: "Sigues adelante, dejando atrás el reloj. La sensación de ser observado se intensifica.",
               en: "You press on, leaving the watch behind. The feeling of being watched intensifies.",
               ja: "時計を後にし、進み続ける。見られている感覚が強まる。",
               ru: "Вы идете дальше, оставив часы позади. Ощущение, что за вами наблюдают, усиливается."
           },
           choices: [
               { text: { es: "Apresurar el paso", en: "Hasten your pace", ja: "ペースを上げる", ru: "Ускорить шаг" }, target: "end_demo" },
               { text: { es: "Detenerse y escuchar", en: "Stop and listen", ja: "立ち止まって聞く", ru: "Остановиться и прислушаться" }, target: "end_demo" }
           ]
       },
       continue_right_changed: {
            image: "story-image-changed.png",
            text: {
                es: "El sendero ahora está cubierto de enredaderas espinosas que parecen susurrar tu nombre. El aire huele a ozono.",
                en: "The path is now covered in thorny vines that seem to whisper your name. The air smells of ozone.",
                ja: "道は今、あなたの名前を囁いているように見える棘のある蔓で覆われている。空気はオゾンの匂いがする。",
                ru: "Тропа теперь покрыта колючими лозами, которые, кажется, шепчут ваше имя. Воздух пахнет озоном."
            },
            choices: [
                 { text: { es: "Abrirse paso entre las espinas", en: "Push through the thorns", ja: "棘をかき分けて進む", ru: "Пробираться сквозь шипы" }, target: "end_demo" },
                 { text: { es: "Buscar otro camino", en: "Look for another way", ja: "別の道を探す", ru: "Искать другой путь" }, target: "end_demo" }
            ]
       },
       end_demo: {
           text: {
               es: "La oscuridad se cierra sobre ti... por ahora.\n\n(Fin de la demo interactiva)",
               en: "Darkness closes in on you... for now.\n\n(End of interactive demo)",
               ja: "闇があなたに迫る…今のところは。\n\n（インタラクティブデモ終了）",
               ru: "Тьма сгущается над вами... пока что.\n\n(Конец интерактивного демо)"
           },
           choices: [
               { text: { es: "Volver a empezar", en: "Start over", ja: "最初からやり直す", ru: "Начать сначала" }, target: "start"}
           ]
       }
    };

    // --- Variables Globales (sin cambios) ---
    const storyImageElement = document.getElementById('story-image');
    const storyTextElement = document.getElementById('story-text');
    const storyChoicesElement = document.getElementById('story-choices');
    const langSelectElement = document.getElementById('lang-select');
    const chatbotTriggerButton = document.getElementById('chatbot-trigger');

    let currentTimeoutId = null;
    let currentLanguage = 'en';
    let currentPassageId = 'start';

    // --- Función Typewriter (sin cambios) ---
    function typeWriter(element, text, speed = 50) {
      if (currentTimeoutId) {
        clearTimeout(currentTimeoutId);
        currentTimeoutId = null;
      }
      element.innerHTML = "";
      let i = 0;
      function type() {
        if (i < text.length) {
          if (text.substring(i, i + 4) === '<br>') {
              element.innerHTML += '<br>';
              i += 4;
          } else {
              element.innerHTML += text.charAt(i);
              i++;
          }
          currentTimeoutId = setTimeout(type, speed);
        } else {
          currentTimeoutId = null;
        }
      }
      if (text && text.length > 0) {
          type();
      }
    }

    // --- Función para Mostrar Pasaje (sin cambios) ---
    function showPassage(passageId) {
      currentPassageId = passageId;
      const passage = storyData[passageId];
      if (!passage) {
        console.error(`Passage not found: ${passageId}`);
        return;
      }
      // Imagen
      if (passage.image) {
        storyImageElement.src = passage.image;
        storyImageElement.alt = `Scene: ${passageId}`;
        storyImageElement.style.display = 'block';
      } else {
        storyImageElement.style.display = 'none';
      }
      // Texto
      const passageText = passage.text[currentLanguage] || passage.text['en'];
      typeWriter(storyTextElement, passageText);
      // Opciones
      storyChoicesElement.innerHTML = '';
      if (passage.choices && passage.choices.length > 0) {
        const ul = document.createElement('ul');
        passage.choices.forEach(choice => {
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = '#';
          a.classList.add('tertiary-button');
          const choiceText = choice.text[currentLanguage] || choice.text['en'];
          a.textContent = choiceText;
          a.addEventListener('click', (event) => {
            event.preventDefault();
            showPassage(choice.target);
          });
          li.appendChild(a);
          ul.appendChild(li);
        });
        storyChoicesElement.appendChild(ul);
      }
    }

    // --- Función para Establecer Idioma (sin cambios) ---
    function setLanguage(lang) {
      if (!translations[lang]) {
        console.warn(`Unsupported language: ${lang}. Falling back to 'en'.`);
        lang = 'en';
      }
      currentLanguage = lang;
      localStorage.setItem('preferredLanguage', lang);
      langSelectElement.value = lang;
      document.documentElement.lang = lang;

      // Aplicar traducciones estáticas
      document.querySelectorAll('[data-translate-key]').forEach(element => {
        const key = element.getAttribute('data-translate-key');
        const translation = translations[lang]?.[key] || translations['en']?.[key];
        if (translation) {
          // Usar innerHTML para copyright y alt text
          if (key === 'copyright' || key === 'game_logo_alt') {
              if (element.tagName === 'IMG') {
                  element.alt = translation;
              } else {
                  element.innerHTML = translation;
              }
          } else {
              element.textContent = translation;
          }
        } else if (key) {
          console.warn(`Translation key not found for '${key}' in language '${lang}' or fallback 'en'`);
        }
      });

       // Actualizar aria-label del botón chatbot
       if (chatbotTriggerButton) {
           const chatbotLabel = translations[lang]?.chatbot_button_label || translations['en']?.chatbot_button_label;
           if (chatbotLabel) {
               chatbotTriggerButton.setAttribute('aria-label', chatbotLabel);
           }
       }

      // Recargar pasaje actual de la historia
       if (currentTimeoutId) {
        clearTimeout(currentTimeoutId);
        currentTimeoutId = null;
      }
      if (storyData[currentPassageId]) {
          showPassage(currentPassageId);
      } else {
          showPassage('start');
      }
    }

    // --- Inicialización y Event Listeners (sin cambios) ---
    document.addEventListener('DOMContentLoaded', () => {
      console.log("Promo page loaded.");

      const savedLang = localStorage.getItem('preferredLanguage');
      const initialLang = savedLang && translations[savedLang] ? savedLang : 'en';
      setLanguage(initialLang);

      // Listener selector de idioma
      langSelectElement.addEventListener('change', (event) => {
        setLanguage(event.target.value);
      });

      // --- Listener para Botón Chatbot ---
      if (chatbotTriggerButton) {
          chatbotTriggerButton.addEventListener('click', () => {
              const chatbotUrl = 'https://character.ai/';
              window.open(chatbotUrl, '_blank');
          });
      } else {
          console.warn("Chatbot trigger button not found.");
      }

      // --- Listeners botones comprar/plataforma ---
      const buyButton = document.querySelector('.buy-button');
      if (buyButton) {
        buyButton.addEventListener('click', () => {
          alert('Redirecting to store... (functionality not implemented)');
        });
      }
      const platformButtons = document.querySelectorAll('.platform-btn');
      platformButtons.forEach(button => {
        button.addEventListener('click', () => {
          const platform = button.textContent;
          console.log(`Platform button pressed: ${platform}`);
        });
      });

      // --- Scroll suave ---
      document.querySelectorAll('.main-nav a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          const targetId = this.getAttribute('href');
          if (targetId.length > 1) {
              e.preventDefault();
              const targetElement = document.querySelector(targetId);
              if (targetElement) {
                  targetElement.scrollIntoView({ behavior: 'smooth' });
              }
          }
        });
      });
    });
